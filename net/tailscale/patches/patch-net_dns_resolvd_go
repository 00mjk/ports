$OpenBSD: patch-net_dns_resolvd_go,v 1.1 2022/01/20 13:31:17 abieber Exp $

Can be removed next release (after 1.20.1):
https://github.com/tailscale/tailscale/pull/3740

Index: net/dns/resolvd.go
--- net/dns/resolvd.go.orig
+++ net/dns/resolvd.go
@@ -16,6 +16,7 @@ import (
 	"regexp"
 	"strings"
 
+	"inet.af/netaddr"
 	"tailscale.com/types/logger"
 	"tailscale.com/util/dnsname"
 )
@@ -130,6 +131,25 @@ func (m resolvdManager) readResolvConf() (config OSCon
 			config.SearchDomains = append(config.SearchDomains, fqdn)
 			continue
 		}
+
+		if strings.HasPrefix(line, "nameserver") {
+			s := strings.TrimPrefix(line, "nameserver")
+			parts := strings.Split(s, " # ")
+			if len(parts) == 0 {
+				return OSConfig{}, err
+			}
+			nameserver := strings.TrimSpace(parts[0])
+			ip, err := netaddr.ParseIP(nameserver)
+			if err != nil {
+				return OSConfig{}, err
+			}
+			config.Nameservers = append(config.Nameservers, ip)
+			continue
+		}
+	}
+
+	if err = scanner.Err(); err != nil {
+		return OSConfig{}, err
 	}
 
 	return config, nil
