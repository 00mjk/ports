$OpenBSD: patch-base_pcap-snoop_c,v 1.2 2021/11/13 19:13:20 tb Exp $

Index: base/pcap-snoop.c
--- base/pcap-snoop.c.orig
+++ base/pcap-snoop.c
@@ -51,7 +51,9 @@
 
 #include <pcap.h>
 #include <unistd.h>
+#ifdef HAVE_PCAP_BPF_H
 #include <pcap-bpf.h>
+#endif
 #ifndef _WIN32
 #include <sys/param.h>
 #endif
@@ -430,7 +432,7 @@ int main(argc,argv)
     
     if(!file){
       if(!interface_name){
-        if(pcap_findalldevs(&interfaces,errbuf)==-1) {
+        if(pcap_findalldevs(&interfaces,errbuf)==-1 || interfaces == NULL) {
           fprintf(stderr,"PCAP: %s\n",errbuf);
           err_exit("Aborting",-1);
         }
