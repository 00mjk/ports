$OpenBSD: patch-hotspot_src_cpu_sparc_vm_debug_sparc_cpp,v 1.1 2021/07/22 00:12:10 kurt Exp $

Add sparc64 support

Index: hotspot/src/cpu/sparc/vm/debug_sparc.cpp
--- hotspot/src/cpu/sparc/vm/debug_sparc.cpp.orig
+++ hotspot/src/cpu/sparc/vm/debug_sparc.cpp
@@ -46,6 +46,9 @@ void pd_ps(frame f) {
   while (sp != NULL && ((intptr_t)sp & 7) == 0 && sp > prev_sp && sp < prev_sp+1000) {
     pc      = next_pc;
     next_pc = (intptr_t*) sp[I7->sp_offset_in_saved_window()];
+#ifdef STACKGHOST
+    next_pc = (intptr_t*) ((intptr_t)next_pc ^ sg_cookie());
+#endif
     tty->print("[%d] sp=%#x pc=", count, sp);
     findpc((intptr_t)pc);
     if (WizardMode && Verbose) {
@@ -55,7 +58,11 @@ void pd_ps(frame f) {
                     sp[0+4],sp[0+5],sp[0+6],sp[0+7]);
       tty->print_cr("    I0..I7: {%#x %#x %#x %#x %#x %#x %#x %#x}",
                     sp[8+0],sp[8+1],sp[8+2],sp[8+3],
+#ifdef STACKGHOST
+                    sp[8+4],sp[8+5],sp[8+6],sp[8+7] ^ sg_cookie());
+#else
                     sp[8+4],sp[8+5],sp[8+6],sp[8+7]);
+#endif
       // (and print stack frame contents too??)
 
       CodeBlob *b = CodeCache::find_blob((address) pc);
