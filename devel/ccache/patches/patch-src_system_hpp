$OpenBSD: patch-src_system_hpp,v 1.3 2021/01/25 21:07:50 sthen Exp $

From 6e95418f15722647f960d8f773edbbecbb46a73c Mon Sep 17 00:00:00 2001
From: Stuart Henderson <sthen@users.noreply.github.com>
Date: Mon, 25 Jan 2021 18:41:54 +0000
Subject: [PATCH] Disable inode cache on OSes without
 pthread_mutexattr_setpshared() (#791)

The inode cache requires pthread_mutexattr_setpshared() and build fails on OSes
with sys/mman.h that do not have this function.

Index: src/system.hpp
--- src/system.hpp.orig
+++ src/system.hpp
@@ -172,7 +172,7 @@ DLLIMPORT extern char** environ;
 #  define O_BINARY 0
 #endif
 
-#ifdef HAVE_SYS_MMAN_H
+#if defined(HAVE_SYS_MMAN_H) && defined(HAVE_PTHREAD_MUTEXATTR_SETPSHARED)
 #  define INODE_CACHE_SUPPORTED
 #endif
 
