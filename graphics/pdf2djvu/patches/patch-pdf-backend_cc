$OpenBSD: patch-pdf-backend_cc,v 1.7 2020/09/07 18:48:38 kili Exp $

Starting with poppler-20, POPPLER_VERSION no longer is numeric -- it's
what POPPLER_VERSION_STRING was in earlier releases.

Index: pdf-backend.cc
--- pdf-backend.cc.orig
+++ pdf-backend.cc
@@ -48,11 +48,7 @@
  * ======================
  */
 
-#if POPPLER_VERSION >= 8500
 static void poppler_error_handler(ErrorCategory category, pdf::Offset pos, const char *message)
-#else
-static void poppler_error_handler(void *data, ErrorCategory category, pdf::Offset pos, const char *message)
-#endif
 {
   std::string format;
   const char *category_name = _("PDF error");
@@ -98,25 +94,10 @@ static void poppler_error_handler(void *data, ErrorCat
   error_log << std::endl;
 }
 
-#if POPPLER_VERSION < 7000
-static void poppler_error_handler(void *data, ErrorCategory category, pdf::Offset pos, char *message)
-{
-  poppler_error_handler(data, category, pos, const_cast<const char *>(message));
-}
-#endif
-
 pdf::Environment::Environment()
 {
-#if POPPLER_VERSION >= 8300
   globalParams = std::unique_ptr<GlobalParams>(new GlobalParams);
-#else
-  globalParams = new GlobalParams;
-#endif
-#if POPPLER_VERSION >= 8500
   setErrorCallback(poppler_error_handler);
-#else
-  setErrorCallback(poppler_error_handler, nullptr);
-#endif
 }
 
 void pdf::Environment::set_antialias(bool value)
@@ -572,12 +553,8 @@ double pdf::get_path_area(splash::Path &path)
 
 pdf::Object *pdf::dict_lookup(pdf::Object &dict, const char *key, pdf::Object *object)
 {
-#if POPPLER_VERSION < 5800
-  return dict.dictLookup(const_cast<char*>(key), object);
-#else
   *object = dict.dictLookup(const_cast<char*>(key));
   return object;
-#endif
 }
 
 pdf::Object *pdf::dict_lookup(pdf::Object *dict, const char *key, pdf::Object *object)
@@ -587,12 +564,8 @@ pdf::Object *pdf::dict_lookup(pdf::Object *dict, const
 
 pdf::Object *pdf::dict_lookup(pdf::Dict *dict, const char *key, pdf::Object *object)
 {
-#if POPPLER_VERSION < 5800
-  return dict->lookup(const_cast<char*>(key), object);
-#else
   *object = dict->lookup(const_cast<char*>(key));
   return object;
-#endif
 }
 
 
@@ -626,25 +599,14 @@ namespace pdf
   }
 }
 
-#if POPPLER_VERSION >= 7200
 const char * pdf::get_c_string(const pdf::String *str)
 {
   return str->c_str();
 }
-#else
-const char * pdf::get_c_string(const pdf::String *str)
-{
-  return str->getCString();
-}
-#endif
 
 int pdf::find_page(pdf::Catalog *catalog, pdf::Ref pgref)
 {
-#if POPPLER_VERSION >= 7600
   return catalog->findPage(pgref);
-#else
-  return catalog->findPage(pgref.num, pgref.gen);
-#endif
 }
 
 // vim:ts=2 sts=2 sw=2 et
