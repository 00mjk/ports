$OpenBSD: patch-src_smspdu_smsud_enc_c,v 1.2 2021/02/26 16:51:40 tb Exp $

Index: src/smspdu/smsud_enc.c
--- src/smspdu/smsud_enc.c.orig
+++ src/smspdu/smsud_enc.c
@@ -21,7 +21,12 @@
 #include <string.h>
 #include <stdlib.h>
 #include <unistd.h>
+#include <limits.h>
 
+#ifndef UINT16_MAX
+#define UINT16_MAX USHRT_MAX
+#endif
+
 static
 uint16_t sms_new_sequence_id () {
   /* this does not have to be good random (linear would be ok)
@@ -150,7 +155,7 @@ char* sms_data_ucs2_encode (struct sms_pdu_ud_header**
   if (headersize) sms_data_insert_header(header,retval+2);
   memcpy(retval+2+strlen(retval+2),tmp,strlen(tmp));
   mem_realloc(tmp,3);
-  sprintf(tmp,"%02X",strlen(retval+2)/2);
+  sprintf(tmp,"%02zX",strlen(retval+2)/2);
   memcpy(retval,tmp,2);
   mem_realloc(tmp,0);
 
@@ -215,8 +220,8 @@ char** sms_data_encode (enum sms_encoding charset,
   }
   fprintf(stderr,"%s: ",_("Notice"));
   fprintf(stderr,
-	  ngettext("This message has %d character",
-		   "This message has %d characters",
+	  ngettext("This message has %zd character",
+		   "This message has %zd characters",
 		   ucs4len(input)),
 	  ucs4len(input));
   fprintf(stderr,"%s"," ");
