$OpenBSD: patch-bg_operators_cpp,v 1.2 2021/10/30 06:41:24 landry Exp $

CascadedUnion API removed in https://github.com/libgeos/geos/commit/156f66840b5814c944d2987bc38a25995a2ad00c

https://github.com/pcb2gcode/pcb2gcode/issues/592

Index: bg_operators.cpp
--- bg_operators.cpp.orig
+++ bg_operators.cpp
@@ -2,7 +2,7 @@
 #include "geometry_int.hpp"
 #include "bg_helpers.hpp"
 #ifdef GEOS_VERSION
-#include <geos/operation/union/CascadedUnion.h>
+#include <geos/operation/union/OverlapUnion.h>
 #include <geos/util/TopologyException.h>
 #include "geos_helpers.hpp"
 #endif // GEOS_VERSION
@@ -244,32 +244,7 @@ multi_polygon_type_fp sum(const std::vector<multi_poly
   } else if (mpolys.size() == 1) {
     return mpolys[0];
   }
-#ifdef GEOS_VERSION
-  std::vector<geos::geom::Geometry*> geos_mpolys;
-  std::vector<std::unique_ptr<geos::geom::Geometry>> geos_mpolys_tmp;
-  for (const auto& mpoly : mpolys) {
-    if (bg::area(mpoly) == 0) {
-      continue;
-    }
-    auto mpoly_temp = mpoly;
-    round(mpoly_temp);
-    geos_mpolys_tmp.push_back(to_geos(mpoly_temp));
-    geos_mpolys.push_back(geos_mpolys_tmp.back().get());
-  }
-  if (geos_mpolys.size() == 0) {
-    return {};
-  }
-  try {
-    std::unique_ptr<geos::geom::Geometry> geos_out(
-        geos::operation::geounion::CascadedUnion::Union(&geos_mpolys));
-    return from_geos<multi_polygon_type_fp>(geos_out);
-  } catch (const geos::util::TopologyException& e) {
-    std::cerr << "\nError: Internal error with libgeos.  Upgrading geos may help." << std::endl;
-    throw;
-  }
-#else // !GEOS_VERSION
   return reduce(mpolys, operator+<polygon_type_fp, multi_polygon_type_fp>);
-#endif // GEOS_VERSION
 }
 
 multi_polygon_type_fp symdiff(const std::vector<multi_polygon_type_fp>& mpolys) {
