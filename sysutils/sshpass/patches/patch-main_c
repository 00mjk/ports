$OpenBSD: patch-main_c,v 1.2 2021/03/23 14:21:54 sthen Exp $

On *BSD an open(2) call on a terminal will never make it the controlling
terminal.

Index: main.c
--- main.c.orig
+++ main.c
@@ -312,6 +312,11 @@ int runprogram( int argc, char *argv[] )
         setsid();
         // This line makes the ptty our controlling tty. We do not otherwise need it open
         slavept=open(name, O_RDWR );
+#ifdef TIOCSCTTY
+        if( ioctl(slavept, TIOCSCTTY)==-1 ) {
+            perror("sshpass: failed to set controlling terminal in child (TIOCSCTTY)");
+        }
+#endif
         close( slavept );
 
         close( masterpt );
