$OpenBSD: patch-provider_plugins_UnixUserPlugin_cpp,v 1.1 2021/11/04 17:11:23 robert Exp $

commit 83f9273b7fe394bf4b20f83fefc5ffb079f131ac
Author: João Gouveia <j.gouveia@kopano.com>
Date:   Fri Apr 23 04:09:11 2021 +1400

    Add a global convert_context to each thread.
    
commit 68c6f76fa1d572e58ce123311374e4bc1381265e
Author: João Gouveia <j.gouveia@kopano.com>
Date:   Fri Apr 23 05:12:31 2021 +1400

    Add a function to create a new iconv_context

Index: provider/plugins/UnixUserPlugin.cpp
--- provider/plugins/UnixUserPlugin.cpp.orig
+++ provider/plugins/UnixUserPlugin.cpp
@@ -101,15 +101,7 @@ UnixUserPlugin::UnixUserPlugin(std::mutex &pluginlock,
 void UnixUserPlugin::InitPlugin(std::shared_ptr<ECStatsCollector> sc)
 {
 	DBPlugin::InitPlugin(std::move(sc));
-
-	const char* charset = m_config->GetSetting("fullname_charset");
-	try {
-		new_iconv_context_if_not_exists<std::string, std::string>("utf-8", charset);
-	} catch (const convert_exception &) {
-		throw std::runtime_error("Cannot setup charset converter, check \"fullname_charset\" in cfg");
-	}
-
-	m_charset = charset;
+	m_charset = m_config->GetSetting("fullname_charset");
 }
 
 void UnixUserPlugin::findUserID(const std::string &id, struct passwd *pwd, char *buffer)
