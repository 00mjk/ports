$OpenBSD: patch-lib_byteorder_h,v 1.2 2021/05/14 07:20:12 jasper Exp $

https://github.com/cyrusimap/cyrus-imapd/commit/d9ee6586e3b87840761421bd24ec5a87f80a3e50
https://github.com/cyrusimap/cyrus-imapd/commit/d325540ef40104429bb69769f000b46a4e8db48d

Index: lib/byteorder.h
--- lib/byteorder.h.orig
+++ lib/byteorder.h
@@ -61,11 +61,15 @@
 #  define ntohll(x) (x)
 
 #else /* small-endian machines */
-#  if defined(__GNUC__) && __GNUC_PREREQ(4, 3)
+#  if defined(__GNUC__) && ((__GNUC__ == 4 && __GNUC_MINOR__ >= 3) || __GNUC__ > 4)
      /* Remove existing macros if present */
+#    undef ntohs
+#    undef htons
 #    undef ntohl
 #    undef htonl
      /* These optimise to single instructions in gcc */
+#    define ntohs(i) __builtin_bswap16(i)
+#    define htons(i) __builtin_bswap16(i)
 #    define ntohl(i) __builtin_bswap32(i)
 #    define htonl(i) __builtin_bswap32(i)
 #    define ntohll(i) __builtin_bswap64(i)
